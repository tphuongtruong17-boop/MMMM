import { opcodes } from './opcodes.js';
export function encodingLength(i) {
    return i < opcodes.OP_PUSHDATA1 ? 1 : i <= 0xff ? 2 : i <= 0xffff ? 3 : 5;
}
export function encode(buffer, num, offset) {
    const size = encodingLength(num);
    if (size === 1) {
        buffer.writeUInt8(num, offset);
    }
    else if (size === 2) {
        buffer.writeUInt8(opcodes.OP_PUSHDATA1, offset);
        buffer.writeUInt8(num, offset + 1);
    }
    else if (size === 3) {
        buffer.writeUInt8(opcodes.OP_PUSHDATA2, offset);
        buffer.writeUInt16LE(num, offset + 1);
    }
    else {
        buffer.writeUInt8(opcodes.OP_PUSHDATA4, offset);
        buffer.writeUInt32LE(num, offset + 1);
    }
    return size;
}
export function decode(buffer, offset) {
    const opcode = buffer.readUInt8(offset);
    let num;
    let size;
    if (opcode < opcodes.OP_PUSHDATA1) {
        num = opcode;
        size = 1;
    }
    else if (opcode === opcodes.OP_PUSHDATA1) {
        if (offset + 2 > buffer.length)
            return null;
        num = buffer.readUInt8(offset + 1);
        size = 2;
    }
    else if (opcode === opcodes.OP_PUSHDATA2) {
        if (offset + 3 > buffer.length)
            return null;
        num = buffer.readUInt16LE(offset + 1);
        size = 3;
    }
    else {
        if (offset + 5 > buffer.length)
            return null;
        if (opcode !== opcodes.OP_PUSHDATA4)
            throw new Error('Unexpected opcode');
        num = buffer.readUInt32LE(offset + 1);
        size = 5;
    }
    return {
        opcode,
        number: num,
        size,
    };
}
