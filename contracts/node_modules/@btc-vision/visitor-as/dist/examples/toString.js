import { ASTTransformVisitor } from "../index.js";
import { SimpleParser } from "../simpleParser.js";
import { not, isStdlib, isMethodNamed, getName } from '../utils.js';
class ToStringCallTransform extends ASTTransformVisitor {
    currentClass;
    fields;
    visitFieldDeclaration(node) {
        const name = getName(node);
        let rhs = `this.${name}.toString()`;
        this.fields.push(`sb.push(\`${name}: \${${rhs}}\`)`);
        super.visitFieldDeclaration(node);
    }
    visitClassDeclaration(node) {
        if (!node.members || node.members.some(isMethodNamed("toString"))) {
            super.visitClassDeclaration(node);
            return;
        }
        this.currentClass = node;
        this.fields = [];
        this.visit(node.members); // will visit fields and methods
        const method = `
  toString(): string {
    const sb = new Array<string>();
    ${this.fields.join(";\n\t")};
    return \`${getName(node)}:\\n\\t\${sb.join("\\n\\t")}\`
  }
    `;
        let member = SimpleParser.parseClassMember(method, node);
        node.members.push(member);
        super.visitClassDeclaration(node);
    }
    afterParse(_) {
        let sources = _.sources.filter(not(isStdlib));
        this.visit(sources);
    }
}
export default ToStringCallTransform;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9TdHJpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZXhhbXBsZXMvdG9TdHJpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRWxELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBdUIsYUFBYSxFQUFFLE9BQU8sRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUl6RixNQUFNLHFCQUFzQixTQUFRLG1CQUFtQjtJQUNyRCxZQUFZLENBQW9CO0lBQ2hDLE1BQU0sQ0FBWTtJQUVsQixxQkFBcUIsQ0FBQyxJQUFzQjtRQUMxQyxNQUFNLElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0IsSUFBSSxHQUFHLEdBQUcsUUFBUSxJQUFJLGFBQWEsQ0FBQztRQUNwQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxhQUFhLElBQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxDQUFDO1FBQ3JELEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBR0QscUJBQXFCLENBQUMsSUFBc0I7UUFDMUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNsRSxLQUFLLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDbEMsT0FBTztRQUNULENBQUM7UUFFRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztRQUN6QixJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGdDQUFnQztRQUMxRCxNQUFNLE1BQU0sR0FBRzs7O01BR2IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO2VBQ2hCLE9BQU8sQ0FBQyxJQUFJLENBQUM7O0tBRXZCLENBQUE7UUFDRCxJQUFJLE1BQU0sR0FBRyxZQUFZLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFCLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBRUQsVUFBVSxDQUFDLENBQVM7UUFDbEIsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDOUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN0QixDQUFDO0NBRUY7QUFHRCxlQUFlLHFCQUFxQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQVNUVHJhbnNmb3JtVmlzaXRvciB9IGZyb20gXCIuLi9pbmRleC5qc1wiO1xyXG5pbXBvcnQgeyBQYXJzZXIsIENsYXNzRGVjbGFyYXRpb24sIEZpZWxkRGVjbGFyYXRpb24gfSBmcm9tIFwiYXNzZW1ibHlzY3JpcHQvZGlzdC9hc3NlbWJseXNjcmlwdC5qc1wiO1xyXG5pbXBvcnQgeyBTaW1wbGVQYXJzZXIgfSBmcm9tIFwiLi4vc2ltcGxlUGFyc2VyLmpzXCI7XHJcbmltcG9ydCB7IG5vdCwgaXNTdGRsaWIsIGNsYXNzTmFtZSwgdG9TdHJpbmcsIGlzTWV0aG9kTmFtZWQsIGdldE5hbWUgfSBmcm9tICcuLi91dGlscy5qcyc7XHJcblxyXG5cclxuXHJcbmNsYXNzIFRvU3RyaW5nQ2FsbFRyYW5zZm9ybSBleHRlbmRzIEFTVFRyYW5zZm9ybVZpc2l0b3Ige1xyXG4gIGN1cnJlbnRDbGFzcz86IENsYXNzRGVjbGFyYXRpb247XHJcbiAgZmllbGRzITogc3RyaW5nW107XHJcblxyXG4gIHZpc2l0RmllbGREZWNsYXJhdGlvbihub2RlOiBGaWVsZERlY2xhcmF0aW9uKTogdm9pZCB7XHJcbiAgICBjb25zdCBuYW1lID0gZ2V0TmFtZShub2RlKTtcclxuICAgIGxldCByaHMgPSBgdGhpcy4ke25hbWV9LnRvU3RyaW5nKClgO1xyXG4gICAgdGhpcy5maWVsZHMucHVzaChgc2IucHVzaChcXGAke25hbWV9OiBcXCR7JHtyaHN9fVxcYClgKTtcclxuICAgIHN1cGVyLnZpc2l0RmllbGREZWNsYXJhdGlvbihub2RlKTtcclxuICB9XHJcblxyXG5cclxuICB2aXNpdENsYXNzRGVjbGFyYXRpb24obm9kZTogQ2xhc3NEZWNsYXJhdGlvbik6IHZvaWQge1xyXG4gICAgaWYgKCFub2RlLm1lbWJlcnMgfHwgbm9kZS5tZW1iZXJzLnNvbWUoaXNNZXRob2ROYW1lZChcInRvU3RyaW5nXCIpKSkge1xyXG4gICAgICBzdXBlci52aXNpdENsYXNzRGVjbGFyYXRpb24obm9kZSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdGhpcy5jdXJyZW50Q2xhc3MgPSBub2RlO1xyXG4gICAgdGhpcy5maWVsZHMgPSBbXTtcclxuICAgIHRoaXMudmlzaXQobm9kZS5tZW1iZXJzKTsgLy8gd2lsbCB2aXNpdCBmaWVsZHMgYW5kIG1ldGhvZHNcclxuICAgIGNvbnN0IG1ldGhvZCA9IGBcclxuICB0b1N0cmluZygpOiBzdHJpbmcge1xyXG4gICAgY29uc3Qgc2IgPSBuZXcgQXJyYXk8c3RyaW5nPigpO1xyXG4gICAgJHt0aGlzLmZpZWxkcy5qb2luKFwiO1xcblxcdFwiKX07XHJcbiAgICByZXR1cm4gXFxgJHtnZXROYW1lKG5vZGUpfTpcXFxcblxcXFx0XFwke3NiLmpvaW4oXCJcXFxcblxcXFx0XCIpfVxcYFxyXG4gIH1cclxuICAgIGBcclxuICAgIGxldCBtZW1iZXIgPSBTaW1wbGVQYXJzZXIucGFyc2VDbGFzc01lbWJlcihtZXRob2QsIG5vZGUpO1xyXG4gICAgbm9kZS5tZW1iZXJzLnB1c2gobWVtYmVyKTtcclxuICAgIHN1cGVyLnZpc2l0Q2xhc3NEZWNsYXJhdGlvbihub2RlKTtcclxuICB9XHJcblxyXG4gIGFmdGVyUGFyc2UoXzogUGFyc2VyKTogdm9pZCB7XHJcbiAgICBsZXQgc291cmNlcyA9IF8uc291cmNlcy5maWx0ZXIobm90KGlzU3RkbGliKSk7XHJcbiAgICB0aGlzLnZpc2l0KHNvdXJjZXMpO1xyXG4gIH1cclxuICBcclxufVxyXG5cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFRvU3RyaW5nQ2FsbFRyYW5zZm9ybTtcclxuIl19