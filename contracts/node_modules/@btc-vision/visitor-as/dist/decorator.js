import { PathTransformVisitor, mergeTransformer } from "./transformer.js";
import { decorates, not, isStdlib } from "./utils.js";
export function registerDecorator(decorator) {
    TopLevelDecorator.registerVisitor(decorator);
    return TopLevelDecorator;
}
export class TopLevelDecorator extends PathTransformVisitor {
    static _visitor;
    static registerVisitor(visitor) {
        TopLevelDecorator._visitor = visitor;
    }
    get visitor() {
        return TopLevelDecorator._visitor;
    }
    visitDecoratorNode(node) {
        if (this.visitor.decoratorMatcher(node)) {
            this.visitor.currentPath = this.currentParentPath;
            this.visitor.visit(this.currentParent);
        }
    }
    afterParse(_) {
        mergeTransformer(this, this.visitor);
        this.visit(this.program.sources.filter(this.visitor.sourceFilter));
    }
}
export class Decorator extends PathTransformVisitor {
    /**
     * Default filter that removes library files
     */
    get sourceFilter() {
        return not(isStdlib);
    }
    get decoratorMatcher() {
        return (node) => decorates(node, this.name);
    }
    get name() { return ""; }
    getDecorator(node) {
        return node.decorators && node.decorators.find(this.decoratorMatcher) || null;
    }
}
export class ClassDecorator extends Decorator {
}
export class FunctionDecorator extends Decorator {
}
export class VariableDecorator extends Decorator {
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2RlY29yYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQVkxRSxPQUFPLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFdEQsTUFBTSxVQUFVLGlCQUFpQixDQUFDLFNBQTJCO0lBQzNELGlCQUFpQixDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM3QyxPQUFPLGlCQUFpQixDQUFDO0FBQzNCLENBQUM7QUFPRCxNQUFNLE9BQU8saUJBQWtCLFNBQVEsb0JBQW9CO0lBQ2pELE1BQU0sQ0FBQyxRQUFRLENBQW1CO0lBRTFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsT0FBeUI7UUFDOUMsaUJBQWlCLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztJQUN2QyxDQUFDO0lBRUQsSUFBWSxPQUFPO1FBQ2pCLE9BQU8saUJBQWlCLENBQUMsUUFBUSxDQUFDO0lBQ3BDLENBQUM7SUFFRCxrQkFBa0IsQ0FBQyxJQUFtQjtRQUNwQyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUN4QyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUM7WUFDbEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7SUFDSCxDQUFDO0lBRUQsVUFBVSxDQUFDLENBQVM7UUFDbEIsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFDckUsQ0FBQztDQUVGO0FBRUQsTUFBTSxPQUFnQixTQUFVLFNBQVEsb0JBQW9CO0lBQzFEOztPQUVHO0lBQ0gsSUFBSSxZQUFZO1FBQ2QsT0FBTyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDdkIsQ0FBQztJQUVELElBQUksZ0JBQWdCO1FBQ2xCLE9BQU8sQ0FBQyxJQUFtQixFQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0lBRUQsSUFBSSxJQUFJLEtBQWEsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRWpDLFlBQVksQ0FBQyxJQUEwQjtRQUNyQyxPQUFPLElBQUksQ0FBQyxVQUFVLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksSUFBSSxDQUFDO0lBQ2hGLENBQUM7Q0FDRjtBQUVELE1BQU0sT0FBZ0IsY0FBZSxTQUFRLFNBQVM7Q0FJckQ7QUFFRCxNQUFNLE9BQWdCLGlCQUFrQixTQUFRLFNBQVM7Q0FFeEQ7QUFFRCxNQUFNLE9BQWdCLGlCQUFrQixTQUFRLFNBQVM7Q0FFeEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYXRoVHJhbnNmb3JtVmlzaXRvciwgbWVyZ2VUcmFuc2Zvcm1lciB9IGZyb20gXCIuL3RyYW5zZm9ybWVyLmpzXCI7XHJcbmltcG9ydCB7XHJcbiAgQ2xhc3NEZWNsYXJhdGlvbixcclxuICBGaWVsZERlY2xhcmF0aW9uLFxyXG4gIE1ldGhvZERlY2xhcmF0aW9uLFxyXG4gIFBhcnNlcixcclxuICBWYXJpYWJsZURlY2xhcmF0aW9uLFxyXG4gIEZ1bmN0aW9uRGVjbGFyYXRpb24sXHJcbiAgU291cmNlLFxyXG4gIERlY29yYXRvck5vZGUsXHJcbiAgRGVjbGFyYXRpb25TdGF0ZW1lbnQsXHJcbn0gZnJvbSBcImFzc2VtYmx5c2NyaXB0L2Rpc3QvYXNzZW1ibHlzY3JpcHQuanNcIjtcclxuaW1wb3J0IHsgZGVjb3JhdGVzLCBub3QsIGlzU3RkbGliIH0gZnJvbSBcIi4vdXRpbHMuanNcIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckRlY29yYXRvcihkZWNvcmF0b3I6IERlY29yYXRvclZpc2l0b3IpIHtcclxuICBUb3BMZXZlbERlY29yYXRvci5yZWdpc3RlclZpc2l0b3IoZGVjb3JhdG9yKTtcclxuICByZXR1cm4gVG9wTGV2ZWxEZWNvcmF0b3I7XHJcbn1cclxuXHJcbmludGVyZmFjZSBEZWNvcmF0b3JWaXNpdG9yIGV4dGVuZHMgUGF0aFRyYW5zZm9ybVZpc2l0b3Ige1xyXG4gIGRlY29yYXRvck1hdGNoZXI6IChub2RlOiBEZWNvcmF0b3JOb2RlKSA9PiBib29sZWFuO1xyXG4gIHNvdXJjZUZpbHRlcjogKHM6IFNvdXJjZSkgPT4gYm9vbDtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFRvcExldmVsRGVjb3JhdG9yIGV4dGVuZHMgUGF0aFRyYW5zZm9ybVZpc2l0b3Ige1xyXG4gIHByaXZhdGUgc3RhdGljIF92aXNpdG9yOiBEZWNvcmF0b3JWaXNpdG9yO1xyXG5cclxuICBzdGF0aWMgcmVnaXN0ZXJWaXNpdG9yKHZpc2l0b3I6IERlY29yYXRvclZpc2l0b3IpOiB2b2lkIHtcclxuICAgIFRvcExldmVsRGVjb3JhdG9yLl92aXNpdG9yID0gdmlzaXRvcjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0IHZpc2l0b3IoKTogRGVjb3JhdG9yVmlzaXRvciB7XHJcbiAgICByZXR1cm4gVG9wTGV2ZWxEZWNvcmF0b3IuX3Zpc2l0b3I7XHJcbiAgfVxyXG5cclxuICB2aXNpdERlY29yYXRvck5vZGUobm9kZTogRGVjb3JhdG9yTm9kZSkge1xyXG4gICAgaWYgKHRoaXMudmlzaXRvci5kZWNvcmF0b3JNYXRjaGVyKG5vZGUpKSB7XHJcbiAgICAgIHRoaXMudmlzaXRvci5jdXJyZW50UGF0aCA9IHRoaXMuY3VycmVudFBhcmVudFBhdGg7XHJcbiAgICAgIHRoaXMudmlzaXRvci52aXNpdCh0aGlzLmN1cnJlbnRQYXJlbnQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYWZ0ZXJQYXJzZShfOiBQYXJzZXIpOiB2b2lkIHtcclxuICAgIG1lcmdlVHJhbnNmb3JtZXIodGhpcywgdGhpcy52aXNpdG9yKTtcclxuICAgIHRoaXMudmlzaXQodGhpcy5wcm9ncmFtLnNvdXJjZXMuZmlsdGVyKHRoaXMudmlzaXRvci5zb3VyY2VGaWx0ZXIpKTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRGVjb3JhdG9yIGV4dGVuZHMgUGF0aFRyYW5zZm9ybVZpc2l0b3Ige1xyXG4gIC8qKlxyXG4gICAqIERlZmF1bHQgZmlsdGVyIHRoYXQgcmVtb3ZlcyBsaWJyYXJ5IGZpbGVzXHJcbiAgICovXHJcbiAgZ2V0IHNvdXJjZUZpbHRlcigpOiAoczogU291cmNlKSA9PiBib29sIHtcclxuICAgIHJldHVybiBub3QoaXNTdGRsaWIpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGRlY29yYXRvck1hdGNoZXIoKTogKG5vZGU6IERlY29yYXRvck5vZGUpID0+IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIChub2RlOiBEZWNvcmF0b3JOb2RlKSA9PiBkZWNvcmF0ZXMobm9kZSwgdGhpcy5uYW1lKVxyXG4gIH1cclxuXHJcbiAgZ2V0IG5hbWUoKTogc3RyaW5nIHsgcmV0dXJuIFwiXCI7IH1cclxuXHJcbiAgZ2V0RGVjb3JhdG9yKG5vZGU6IERlY2xhcmF0aW9uU3RhdGVtZW50KTogRGVjb3JhdG9yTm9kZSB8IG51bGwge1xyXG4gICAgcmV0dXJuIG5vZGUuZGVjb3JhdG9ycyAmJiBub2RlLmRlY29yYXRvcnMuZmluZCh0aGlzLmRlY29yYXRvck1hdGNoZXIpIHx8IG51bGw7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQ2xhc3NEZWNvcmF0b3IgZXh0ZW5kcyBEZWNvcmF0b3Ige1xyXG4gIGFic3RyYWN0IHZpc2l0RmllbGREZWNsYXJhdGlvbihub2RlOiBGaWVsZERlY2xhcmF0aW9uKTogdm9pZDtcclxuICBhYnN0cmFjdCB2aXNpdE1ldGhvZERlY2xhcmF0aW9uKG5vZGU6IE1ldGhvZERlY2xhcmF0aW9uKTogdm9pZDtcclxuICBhYnN0cmFjdCB2aXNpdENsYXNzRGVjbGFyYXRpb24obm9kZTogQ2xhc3NEZWNsYXJhdGlvbik6IHZvaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBGdW5jdGlvbkRlY29yYXRvciBleHRlbmRzIERlY29yYXRvciB7XHJcbiAgYWJzdHJhY3QgdmlzaXRGdW5jdGlvbkRlY2xhcmF0aW9uKG5vZGU6IEZ1bmN0aW9uRGVjbGFyYXRpb24pOiB2b2lkO1xyXG59XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgVmFyaWFibGVEZWNvcmF0b3IgZXh0ZW5kcyBEZWNvcmF0b3Ige1xyXG4gIGFic3RyYWN0IHZpc2l0VmFyaWFibGVEZWNsYXJhdGlvbihub2RlOiBWYXJpYWJsZURlY2xhcmF0aW9uKTogdm9pZDtcclxufVxyXG4iXX0=